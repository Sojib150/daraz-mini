<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bubble Shooter</title>

<style>
body{
  margin:0;
  background:#0b1d3a;
  overflow:hidden;
  touch-action: none;
}

canvas{
  display:block;
  margin:auto;
  background:linear-gradient(#1b3b6f,#0b1d3a);
}
</style>
</head>

<body>

<canvas id="game" width="360" height="640"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const W = canvas.width;
const H = canvas.height;

const colors = ["red","yellow","cyan","lime","orange","violet"];

let bubbles = [];
let shooter = { x: W/2, y: H-40, r: 14, color: randColor() };
let flying = null;

function randColor(){
  return colors[Math.floor(Math.random()*colors.length)];
}

// create top bubbles
for(let y=40;y<200;y+=30){
  for(let x=40;x<W;x+=40){
    bubbles.push({x,y,r:14,color:randColor()});
  }
}

canvas.addEventListener("touchstart", shoot);
canvas.addEventListener("mousedown", shoot);

function shoot(e){
  if(flying) return;

  let rect = canvas.getBoundingClientRect();
  let tx = (e.touches?e.touches[0].clientX:e.clientX)-rect.left;
  let ty = (e.touches?e.touches[0].clientY:e.clientY)-rect.top;

  let dx = tx - shooter.x;
  let dy = ty - shooter.y;
  let len = Math.hypot(dx,dy);

  flying = {
    x: shooter.x,
    y: shooter.y,
    vx: dx/len*6,
    vy: dy/len*6,
    r:14,
    color:shooter.color
  };

  shooter.color = randColor();
}

function update(){
  if(flying){
    flying.x += flying.vx;
    flying.y += flying.vy;

    if(flying.x<14 || flying.x>W-14) flying.vx*=-1;

    for(let b of bubbles){
      let d = Math.hypot(flying.x-b.x, flying.y-b.y);
      if(d < 28){
        bubbles.push({x:flying.x,y:flying.y,r:14,color:flying.color});
        flying = null;
        break;
      }
    }

    if(flying && flying.y < 30){
      bubbles.push({x:flying.x,y:flying.y,r:14,color:flying.color});
      flying=null;
    }
  }
}

function draw(){
  ctx.clearRect(0,0,W,H);

  for(let b of bubbles){
    ctx.beginPath();
    ctx.fillStyle=b.color;
    ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fill();
  }

  if(flying){
    ctx.beginPath();
    ctx.fillStyle=flying.color;
    ctx.arc(flying.x,flying.y,flying.r,0,Math.PI*2);
    ctx.fill();
  }

  ctx.beginPath();
  ctx.fillStyle=shooter.color;
  ctx.arc(shooter.x,shooter.y,shooter.r,0,Math.PI*2);
  ctx.fill();
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>