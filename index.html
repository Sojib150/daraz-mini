<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Econsave TPG1 - Work Tracker</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #f2fdf4;
      margin: 0;
      padding: 0;
    }
    header {
      background: #007f33;
      color: white;
      text-align: center;
      padding: 15px 0;
      font-size: 20px;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .container {
      max-width: 850px;
      margin: 25px auto;
      padding: 0 15px;
    }
    .card {
      background: white;
      border-radius: 14px;
      padding: 15px;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: 0.3s;
    }
    .card:hover {
      transform: scale(1.02);
    }
    .info {
      flex: 1;
    }
    .name {
      font-weight: 600;
      color: #005c1f;
      font-size: 16px;
    }
    .id {
      font-size: 13px;
      color: gray;
    }
    select {
      padding: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
      background: #f0fdf4;
      font-weight: 500;
    }
    button {
      background: #007f33;
      color: white;
      border: none;
      padding: 7px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin-left: 6px;
    }
    button:hover {
      background: #00a347;
    }
  </style>
</head>
<body>
  <header>
    üè≠ Econsave TPG1 - Work Allocation & Tracking System
  </header>

  <div class="container" id="workerList"></div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB6b93A_HeU4FADs3o2Ysw6-dlRRS2TbZk",
      authDomain: "telegram-miniapp-e8cc0.firebaseapp.com",
      projectId: "telegram-miniapp-e8cc0",
      storageBucket: "telegram-miniapp-e8cc0.firebasestorage.app",
      messagingSenderId: "827930913054",
      appId: "1:827930913054:web:502b56e0c198d8e9ff410f",
      databaseURL: "https://telegram-miniapp-e8cc0-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Workers list (add all employees here)
    const workers = [
      { id: "EC001", name: "MOHAMMAD MASUD (Supervisor)" },
      { id: "EC002", name: "MD RAHIM" },
      { id: "EC003", name: "ABDUL KARIM" },
      { id: "EC004", name: "MD SALAM" },
      { id: "EC005", name: "HASAN ALI" },
      { id: "EC006", name: "RAKIB HOSSAIN" },
      { id: "EC007", name: "SHAFIQ ISLAM" },
      { id: "EC008", name: "JONY AHMED" },
      { id: "EC009", name: "TANVIR AHMED" },
      { id: "EC010", name: "MASUM RANA" },
      { id: "EC011", name: "SOHEL" },
      { id: "EC012", name: "KAMAL" },
      { id: "EC013", name: "NAYEEM" },
      { id: "EC014", name: "SAGOR" },
      { id: "EC015", name: "RUBEL" },
      { id: "EC016", name: "ARIF" },
      { id: "EC017", name: "BIPLOB" },
      { id: "EC018", name: "SUMON" },
      { id: "EC019", name: "JAHID" },
      { id: "EC020", name: "RANA" }
    ];

    // Work list
    const workList = [
      "Unloading goods from container",
      "Arranging goods by barcode",
      "Receiving goods",
      "Picking goods",
      "QC checking",
      "Driving forklift",
      "MC (Medical leave / sick)",
      "Store cleaning",
      "No work"
    ];

    const workerListDiv = document.getElementById("workerList");

    // Build UI
    workers.forEach((worker) => {
      const card = document.createElement("div");
      card.className = "card";

      const info = document.createElement("div");
      info.className = "info";
      info.innerHTML = `<div class='name'>${worker.name}</div><div class='id'>${worker.id}</div>`;

      const select = document.createElement("select");
      workList.forEach((work) => {
        const opt = document.createElement("option");
        opt.value = work;
        opt.textContent = work;
        select.appendChild(opt);
      });

      const btn = document.createElement("button");
      btn.textContent = "Update";

      // Load existing work from Firebase
      const dbRef = ref(db, "workers/" + worker.id);
      onValue(dbRef, (snapshot) => {
        if (snapshot.exists()) {
          select.value = snapshot.val().work || "No work";
        }
      });

      // Update button click
      btn.addEventListener("click", () => {
        set(ref(db, "workers/" + worker.id), {
          name: worker.name,
          work: select.value
        });
        alert(`${worker.name} ‚Üí ${select.value} ‚úÖ`);
      });

      card.appendChild(info);
      card.appendChild(select);
      card.appendChild(btn);
      workerListDiv.appendChild(card);
    });
  </script>
</body>
</html>
