<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Econsave TPG1 Work Tracker</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #2b7a0b;
      color: white;
      text-align: center;
      padding: 15px 0;
      font-size: 22px;
      font-weight: bold;
      letter-spacing: 0.5px;
    }
    .container {
      max-width: 800px;
      margin: 25px auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .worker {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #eee;
      padding: 12px 0;
      flex-wrap: wrap;
    }
    .worker:last-child {
      border-bottom: none;
    }
    .worker span {
      font-weight: 600;
      flex: 1;
      min-width: 150px;
    }
    select {
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      margin-right: 10px;
    }
    button {
      background-color: #2b7a0b;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: 0.2s;
    }
    button:hover {
      background-color: #256b09;
    }
    .time {
      font-size: 12px;
      color: gray;
      margin-top: 4px;
      flex-basis: 100%;
    }
  </style>
</head>
<body>
  <header>Econsave TPG1 Work Tracker</header>
  <div class="container" id="workerList"></div>

  <!-- Firebase -->
  <script type="module">
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB6b93A_HeU4FADs3o2Ysw6-dlRRS2TbZk",
      authDomain: "telegram-miniapp-e8cc0.firebaseapp.com",
      projectId: "telegram-miniapp-e8cc0",
      storageBucket: "telegram-miniapp-e8cc0.firebasestorage.app",
      messagingSenderId: "827930913054",
      appId: "1:827930913054:web:502b56e0c198d8e9ff410f",
      databaseURL: "https://telegram-miniapp-e8cc0-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Worker names
    const workers = [
      "MOHAMMAD MASUD",
      "RAFIUL ISLAM",
      "ALAMIN",
      "MIAH SOHAG",
      "SHARIFUL ISLAM",
      "SOJEEB MIAH",
      "DELUAR",
      "SAJIB",
      "MIAH RUBEL",
      "MATANG DAH",
      "RANA SOHAL",
      "BAINATH YADAV",
      "KAMESHWER",
      "RANJIT KUMAR",
      "SANJAY KUMAR",
      "RAI AASH BAHADUR",
      "SAHAN UPENDRA",
      "SAH TELI SHANKAR PRASAD",
      "RAY TEJNAYAN",
      "AHAMMED MD SAMIM",
      "MOHAMMED ASHRAFUL",
      "SHEKH MD SAKIB",
      "ISLAM MD AHANARUL",
      "BIJAYA TAMANG",
      "THAKUR JAY PRAKASH",
      "BOHARA LAXMAN",
      "BHANDARI LIL MAN",
      "BISHWAKARMA BHUPAT RAJ",
      "BISHOKARMA NOM BAHADUR",
      "BOHARA PREM",
      "YADAV DINESH KUMAR",
      "BK RAJ KUMAR"
    ];

    const workOptions = [
      "Unloading goods from container",
      "Arranging goods by barcode",
      "Receiving goods",
      "Picking goods",
      "QC checking",
      "Driving forklift",
      "MC (Medical leave / sick)",
      "Store cleaning",
      "No work"
    ];

    const workerList = document.getElementById("workerList");

    // Display workers
    workers.forEach(name => {
      const div = document.createElement("div");
      div.className = "worker";
      div.innerHTML = `
        <span>${name}</span>
        <select id="${name.replace(/\s+/g, '_')}">
          ${workOptions.map(w => `<option value="${w}">${w}</option>`).join('')}
        </select>
        <button id="btn_${name.replace(/\s+/g, '_')}">Update</button>
        <div class="time" id="time_${name.replace(/\s+/g, '_')}"></div>
      `;
      workerList.appendChild(div);

      const select = div.querySelector("select");
      const button = div.querySelector("button");
      const timeDisplay = div.querySelector(".time");

      const workRef = ref(db, "workers/" + name);

      onValue(workRef, (snapshot) => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          select.value = data.work;
          timeDisplay.textContent = data.time ? `Last updated: ${data.time}` : "";
        }
      });

      button.addEventListener("click", () => {
        const now = new Date();
        const timeString = now.toLocaleString('en-MY', { timeZone: 'Asia/Kuala_Lumpur' });
        set(workRef, {
          work: select.value,
          time: timeString
        });
        timeDisplay.textContent = `Last updated: ${timeString}`;
      });
    });
  </script>
</body>
</html>
